{"remainingRequest":"E:\\Face_attendance_system\\frontend\\node_modules\\babel-loader\\lib\\index.js!E:\\Face_attendance_system\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!E:\\Face_attendance_system\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\Face_attendance_system\\frontend\\src\\views\\Register.vue?vue&type=script&lang=js","dependencies":[{"path":"E:\\Face_attendance_system\\frontend\\src\\views\\Register.vue","mtime":1745508957740},{"path":"E:\\Face_attendance_system\\frontend\\babel.config.js","mtime":1745498655640},{"path":"E:\\Face_attendance_system\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1745498657290},{"path":"E:\\Face_attendance_system\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1745498657101},{"path":"E:\\Face_attendance_system\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1745498657290},{"path":"E:\\Face_attendance_system\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1745498665241}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZXJyb3IuY2F1c2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5jb25zdHJ1Y3Rvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLml0ZXJhdG9yLmZvci1lYWNoLmpzIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJSZWdpc3RlciIsCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHZpZGVvU3RyZWFtOiBudWxsLAogICAgICBjYXB0dXJlZEltYWdlOiBudWxsLAogICAgICBzdHVkZW50SWQ6ICIiLAogICAgICBzdHVkZW50TmFtZTogIiIsCiAgICAgIGNsYXNzSWQ6ICIiLAogICAgICBjbGFzc2VzOiBbewogICAgICAgIGlkOiAiY2xhc3MxIiwKICAgICAgICBuYW1lOiAi6K6h566X5py656eR5a2m5LiO5oqA5pyvMeePrSIKICAgICAgfSwgewogICAgICAgIGlkOiAiY2xhc3MyIiwKICAgICAgICBuYW1lOiAi6L2v5Lu25bel56iLMeePrSIKICAgICAgfSwgewogICAgICAgIGlkOiAiY2xhc3MzIiwKICAgICAgICBuYW1lOiAi5Lq65bel5pm66IO9MeePrSIKICAgICAgfV0sCiAgICAgIGlzU3VibWl0dGluZzogZmFsc2UsCiAgICAgIHJlZ2lzdHJhdGlvblN0YXR1czogbnVsbCwKICAgICAgZXhjZWxGaWxlOiBudWxsLAogICAgICBpc0ltcG9ydGluZzogZmFsc2UsCiAgICAgIGltcG9ydFJlc3VsdDogbnVsbAogICAgfTsKICB9LAogIG1vdW50ZWQoKSB7CiAgICB0aGlzLnN0YXJ0Q2FtZXJhKCk7CiAgfSwKICBiZWZvcmVVbm1vdW50KCkgewogICAgdGhpcy5zdG9wQ2FtZXJhKCk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBzdGFydENhbWVyYSgpIHsKICAgICAgaWYgKG5hdmlnYXRvci5tZWRpYURldmljZXMgJiYgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEpIHsKICAgICAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSh7CiAgICAgICAgICB2aWRlbzogdHJ1ZQogICAgICAgIH0pLnRoZW4oc3RyZWFtID0+IHsKICAgICAgICAgIHRoaXMudmlkZW9TdHJlYW0gPSBzdHJlYW07CiAgICAgICAgICB0aGlzLiRyZWZzLnZpZGVvLnNyY09iamVjdCA9IHN0cmVhbTsKICAgICAgICB9KS5jYXRjaChlcnIgPT4gewogICAgICAgICAgY29uc29sZS5lcnJvcigi5peg5rOV6K6/6Zeu5pGE5YOP5aS0OiIsIGVycik7CiAgICAgICAgICBhbGVydCgi5peg5rOV6K6/6Zeu5pGE5YOP5aS077yM6K+356Gu5L+d5oKo55qE6K6+5aSH5pyJ5pGE5YOP5aS05bm25LiU5bey5o6I5p2D5L2/55So44CCIik7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5lcnJvcigi5rWP6KeI5Zmo5LiN5pSv5oyBZ2V0VXNlck1lZGlhIik7CiAgICAgICAgYWxlcnQoIuaCqOeahOa1j+iniOWZqOS4jeaUr+aMgeiuv+mXruaRhOWDj+WktOWKn+iDve+8jOivt+abtOaNoua1j+iniOWZqOWQjumHjeivleOAgiIpOwogICAgICB9CiAgICB9LAogICAgc3RvcENhbWVyYSgpIHsKICAgICAgaWYgKHRoaXMudmlkZW9TdHJlYW0pIHsKICAgICAgICB0aGlzLnZpZGVvU3RyZWFtLmdldFRyYWNrcygpLmZvckVhY2godHJhY2sgPT4gdHJhY2suc3RvcCgpKTsKICAgICAgfQogICAgfSwKICAgIGNhcHR1cmVJbWFnZSgpIHsKICAgICAgY29uc3QgdmlkZW8gPSB0aGlzLiRyZWZzLnZpZGVvOwogICAgICBjb25zdCBjYW52YXMgPSB0aGlzLiRyZWZzLmNhbnZhczsKICAgICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwoKICAgICAgLy8g6K6+572uY2FudmFz5bC65a+45LiO6KeG6aKR5LiA6Ie0CiAgICAgIGNhbnZhcy53aWR0aCA9IHZpZGVvLnZpZGVvV2lkdGg7CiAgICAgIGNhbnZhcy5oZWlnaHQgPSB2aWRlby52aWRlb0hlaWdodDsKCiAgICAgIC8vIOWcqGNhbnZhc+S4iue7mOWItuW9k+WJjeinhumikeW4pwogICAgICBjb250ZXh0LmRyYXdJbWFnZSh2aWRlbywgMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsKCiAgICAgIC8vIOiOt+WPluWbvuWDj+aVsOaNruW5tui9rOaNouS4ulVSTCAo6auY6LSo6YePSlBFRykKICAgICAgdGhpcy5jYXB0dXJlZEltYWdlID0gY2FudmFzLnRvRGF0YVVSTCgiaW1hZ2UvanBlZyIsIDAuOTUpOwogICAgICBjb25zb2xlLmxvZygi5Zu+5YOP5bey5o2V6I63Iik7CiAgICAgIGNvbnNvbGUubG9nKGDlm77lg4/mlbDmja7plb/luqY6ICR7dGhpcy5jYXB0dXJlZEltYWdlLmxlbmd0aH0g5a2X56ymYCk7CiAgICAgIGNvbnNvbGUubG9nKGDlm77lg4/mlbDmja7liY3nvIA6ICR7dGhpcy5jYXB0dXJlZEltYWdlLnN1YnN0cmluZygwLCA1MCl9Li4uYCk7CiAgICB9LAogICAgY2xlYXJDYXB0dXJlZEltYWdlKCkgewogICAgICB0aGlzLmNhcHR1cmVkSW1hZ2UgPSBudWxsOwogICAgfSwKICAgIGFzeW5jIHJlZ2lzdGVyRmFjZSgpIHsKICAgICAgLy8g6KGo5Y2V6aqM6K+BCiAgICAgIGlmICghdGhpcy5jYXB0dXJlZEltYWdlKSB7CiAgICAgICAgdGhpcy5zaG93U3RhdHVzKCLor7flhYjmi43nhafmjZXojrfkurrohLjlm77lg48iLCAiZXJyb3IiKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLnN0dWRlbnRJZCB8fCAhdGhpcy5zdHVkZW50TmFtZSB8fCAhdGhpcy5jbGFzc0lkKSB7CiAgICAgICAgdGhpcy5zaG93U3RhdHVzKCLor7floavlhpnmiYDmnInlv4XopoHkv6Hmga8iLCAiZXJyb3IiKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5pc1N1Ym1pdHRpbmcgPSB0cnVlOyAvLyDlvIDlp4vmj5DkuqTnirbmgIEKICAgICAgdGhpcy5zaG93U3RhdHVzKCLmraPlnKjlpITnkIblm77lg4/lkozkv53lrZjkv6Hmga8uLi4iLCAicGVuZGluZyIpOwogICAgICB0cnkgewogICAgICAgIGNvbnNvbGUubG9nKCLlh4blpIflj5HpgIHms6jlhozor7fmsYI6Iik7CiAgICAgICAgY29uc29sZS5sb2coYOWtpuWPtzogJHt0aGlzLnN0dWRlbnRJZH0sIOWnk+WQjTogJHt0aGlzLnN0dWRlbnROYW1lfSwg54+t57qnOiAke3RoaXMuY2xhc3NJZH1gKTsKICAgICAgICBjb25zb2xlLmxvZyhg5Zu+5YOP5pWw5o2u6ZW/5bqmOiAke3RoaXMuY2FwdHVyZWRJbWFnZS5sZW5ndGh9IOWtl+espmApOwogICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJyZWdpc3RlckZhY2UiLCB7CiAgICAgICAgICBpbWFnZURhdGE6IHRoaXMuY2FwdHVyZWRJbWFnZSwKICAgICAgICAgIHN0dWRlbnRJZDogdGhpcy5zdHVkZW50SWQsCiAgICAgICAgICBzdHVkZW50TmFtZTogdGhpcy5zdHVkZW50TmFtZSwKICAgICAgICAgIGNsYXNzSWQ6IHRoaXMuY2xhc3NJZAogICAgICAgIH0pOwogICAgICAgIGNvbnNvbGUubG9nKCLms6jlhozor7fmsYLlk43lupQ6IiwgcmVzdWx0KTsKICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHsKICAgICAgICAgIHRoaXMuc2hvd1N0YXR1cygi5rOo5YaM5oiQ5Yqf77yBIiwgInN1Y2Nlc3MiKTsKICAgICAgICAgIC8vIOmHjee9ruihqOWNlQogICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3R1ZGVudElkID0gIiI7CiAgICAgICAgICAgIHRoaXMuc3R1ZGVudE5hbWUgPSAiIjsKICAgICAgICAgICAgdGhpcy5jbGFzc0lkID0gIiI7CiAgICAgICAgICAgIHRoaXMuY2xlYXJDYXB0dXJlZEltYWdlKCk7CiAgICAgICAgICAgIHRoaXMucmVnaXN0cmF0aW9uU3RhdHVzID0gbnVsbDsKICAgICAgICAgIH0sIDIwMDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNob3dTdGF0dXMoYOazqOWGjOWksei0pTogJHtyZXN1bHQuZXJyb3IgfHwgJ+acquefpemUmeivryd9YCwgImVycm9yIik7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIuazqOWGjOi/h+eoi+S4reWPkeeUn+mUmeivrzoiLCBlcnJvcik7CiAgICAgICAgdGhpcy5zaG93U3RhdHVzKGDms6jlhozplJnor686ICR7ZXJyb3IubWVzc2FnZSB8fCAn5pyq55+l6ZSZ6K+vJ31gLCAiZXJyb3IiKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICB0aGlzLmlzU3VibWl0dGluZyA9IGZhbHNlOyAvLyDnu5PmnZ/mj5DkuqTnirbmgIEKICAgICAgfQogICAgfSwKICAgIHNob3dTdGF0dXMobWVzc2FnZSwgdHlwZSkgewogICAgICB0aGlzLnJlZ2lzdHJhdGlvblN0YXR1cyA9IHsKICAgICAgICBtZXNzYWdlLAogICAgICAgIHR5cGUKICAgICAgfTsKICAgIH0sCiAgICBkb3dubG9hZFRlbXBsYXRlKCkgewogICAgICAvLyDmmL7npLrkuIvovb3kuK3nirbmgIEKICAgICAgdGhpcy5zaG93U3RhdHVzKCLmraPlnKjlh4blpIdFeGNlbOaooeadvy4uLiIsICJpbmZvIik7CgogICAgICAvLyDkvb/nlKjkuJPpl6jnmoRBUEnnq6/ngrnojrflj5bmqKHmnb8KICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAiL2FwaS9zdHVkZW50X3RlbXBsYXRlIjsKCiAgICAgIC8vIOaYvuekuuaIkOWKn+eKtuaAgQogICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICB0aGlzLnNob3dTdGF0dXMoIuaooeadv+W3suS4i+i9ve+8jOivt+afpeeci+S4i+i9veaWh+S7tuWkuSIsICJzdWNjZXNzIik7CgogICAgICAgIC8vIDPnp5LlkI7muIXpmaTnirbmgIEKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHRoaXMucmVnaXN0cmF0aW9uU3RhdHVzID0gbnVsbDsKICAgICAgICB9LCAzMDAwKTsKICAgICAgfSwgMTAwMCk7CiAgICB9LAogICAgYXN5bmMgaW1wb3J0RXhjZWwoKSB7CiAgICAgIGlmICghdGhpcy5leGNlbEZpbGUpIHsKICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ1NFVF9FUlJPUicsICfor7flhYjpgInmi6lFeGNlbOaWh+S7ticpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLmlzSW1wb3J0aW5nID0gdHJ1ZTsKICAgICAgdGhpcy5pbXBvcnRSZXN1bHQgPSBudWxsOwogICAgICB0cnkgewogICAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7CiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdmaWxlJywgdGhpcy5leGNlbEZpbGUpOwogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy9hcGkvaW1wb3J0X2V4Y2VsJywgewogICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICBib2R5OiBmb3JtRGF0YQogICAgICAgIH0pOwogICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsKICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IocmVzdWx0LmVycm9yIHx8ICflr7zlhaXlpLHotKUnKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5pbXBvcnRSZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzICYmIHJlc3VsdC5mYWlsZWRfY291bnQgPT09IDApIHsKICAgICAgICAgIHRoaXMuZXhjZWxGaWxlID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignRXhjZWzlr7zlhaXlh7rplJk6JywgZXJyb3IpOwogICAgICAgIHRoaXMuaW1wb3J0UmVzdWx0ID0gewogICAgICAgICAgc3VjY2VzczogZmFsc2UsCiAgICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSB8fCAn5a+85YWl6L+H56iL5Lit5Y+R55Sf6ZSZ6K+vJwogICAgICAgIH07CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgdGhpcy5pc0ltcG9ydGluZyA9IGZhbHNlOwogICAgICB9CiAgICB9CiAgfQp9Ow=="},{"version":3,"names":["name","data","videoStream","capturedImage","studentId","studentName","classId","classes","id","isSubmitting","registrationStatus","excelFile","isImporting","importResult","mounted","startCamera","beforeUnmount","stopCamera","methods","navigator","mediaDevices","getUserMedia","video","then","stream","$refs","srcObject","catch","err","console","error","alert","getTracks","forEach","track","stop","captureImage","canvas","context","getContext","width","videoWidth","height","videoHeight","drawImage","toDataURL","log","length","substring","clearCapturedImage","registerFace","showStatus","result","$store","dispatch","imageData","success","setTimeout","message","type","downloadTemplate","window","location","href","importExcel","commit","formData","FormData","append","response","fetch","method","body","json","ok","Error","failed_count"],"sources":["src/views/Register.vue"],"sourcesContent":["<template>\r\n  <div class=\"register-page\">\r\n    <v-container>\r\n      <v-row>\r\n        <v-col cols=\"12\">\r\n          <v-card class=\"solid-card mt-3 mb-5\" elevation=\"3\">\r\n            <v-card-title class=\"text-h4 font-weight-bold primary--text py-4\">\r\n              <v-icon large color=\"primary\" class=\"mr-3\">mdi-account-plus</v-icon>\r\n              人脸注册\r\n            </v-card-title>\r\n          </v-card>\r\n        </v-col>\r\n      </v-row>\r\n      \r\n      <v-row>\r\n        <v-col cols=\"12\" md=\"7\">\r\n          <v-card class=\"solid-card hover-card mb-4\" elevation=\"2\">\r\n            <v-card-title class=\"subtitle-1 font-weight-medium\">\r\n              <v-icon left color=\"primary\">mdi-camera</v-icon>\r\n              拍摄人脸照片\r\n            </v-card-title>\r\n            <v-card-text>\r\n              <div class=\"video-container rounded-image\">\r\n                <video ref=\"video\" width=\"640\" height=\"480\" autoplay class=\"rounded-lg\"></video>\r\n                <canvas ref=\"canvas\" width=\"640\" height=\"480\" style=\"display: none;\"></canvas>\r\n                <transition name=\"fade\">\r\n                  <div class=\"captured-container\" v-if=\"capturedImage\">\r\n                    <img :src=\"capturedImage\" alt=\"Captured Image\" class=\"captured-image rounded-lg\" />\r\n                    <v-btn fab small color=\"error\" class=\"clear-btn btn-pulse\" @click=\"clearCapturedImage\">\r\n                      <v-icon>mdi-refresh</v-icon>\r\n                    </v-btn>\r\n                  </div>\r\n                </transition>\r\n                <v-btn\r\n                  color=\"primary\"\r\n                  large\r\n                  rounded\r\n                  class=\"capture-btn btn-pulse mt-3\"\r\n                  v-if=\"!capturedImage\"\r\n                  @click=\"captureImage\"\r\n                >\r\n                  <v-icon left>mdi-camera</v-icon>\r\n                  拍照\r\n                </v-btn>\r\n              </div>\r\n            </v-card-text>\r\n          </v-card>\r\n        </v-col>\r\n        \r\n        <v-col cols=\"12\" md=\"5\">\r\n          <div class=\"card-wrapper\">\r\n            <v-card class=\"solid-card hover-card mb-4\" elevation=\"2\">\r\n              <v-card-title class=\"subtitle-1 font-weight-medium\">\r\n                <v-icon left color=\"primary\">mdi-account-details</v-icon>\r\n                学生信息\r\n              </v-card-title>\r\n              <v-card-text>\r\n                <div class=\"form-container\">\r\n                  <v-form @submit.prevent=\"registerFace\">\r\n                    <v-text-field\r\n                      v-model=\"studentId\"\r\n                      label=\"学号\"\r\n                      prepend-icon=\"mdi-identifier\"\r\n                      outlined\r\n                      dense\r\n                      required\r\n                      class=\"mb-3\"\r\n                    ></v-text-field>\r\n                    \r\n                    <v-text-field\r\n                      v-model=\"studentName\"\r\n                      label=\"姓名\"\r\n                      prepend-icon=\"mdi-account\"\r\n                      outlined\r\n                      dense\r\n                      required\r\n                      class=\"mb-3\"\r\n                    ></v-text-field>\r\n                    \r\n                    <v-select\r\n                      v-model=\"classId\"\r\n                      :items=\"classes\"\r\n                      item-text=\"name\"\r\n                      item-value=\"id\"\r\n                      label=\"班级\"\r\n                      prepend-icon=\"mdi-account-group\"\r\n                      outlined\r\n                      dense\r\n                      required\r\n                      class=\"mb-5\"\r\n                    ></v-select>\r\n                    \r\n                    <v-btn \r\n                      type=\"submit\" \r\n                      color=\"primary\" \r\n                      block \r\n                      large\r\n                      rounded\r\n                      class=\"btn-pulse\" \r\n                      elevation=\"2\"\r\n                      :loading=\"isSubmitting\"\r\n                      :disabled=\"isSubmitting || !capturedImage || !studentId || !studentName || !classId\"\r\n                    >\r\n                      <v-icon left>mdi-content-save</v-icon>\r\n                      {{ isSubmitting ? '保存中...' : '保存注册信息' }}\r\n                    </v-btn>\r\n                    \r\n                    <transition name=\"fade\">\r\n                      <v-alert\r\n                        v-if=\"registrationStatus\"\r\n                        :type=\"registrationStatus.type === 'success' ? 'success' : \r\n                              registrationStatus.type === 'error' ? 'error' : 'info'\"\r\n                        dense\r\n                        class=\"mt-4\"\r\n                        transition=\"scale-transition\"\r\n                      >\r\n                        {{ registrationStatus.message }}\r\n                      </v-alert>\r\n                    </transition>\r\n                  </v-form>\r\n                </div>\r\n              </v-card-text>\r\n            </v-card>\r\n          </div>\r\n          \r\n          <v-card class=\"solid-card hover-card mb-4\" elevation=\"2\">\r\n            <v-card-title class=\"subtitle-1 font-weight-medium\">\r\n              <v-icon left color=\"primary\">mdi-file-excel</v-icon>\r\n              批量导入\r\n            </v-card-title>\r\n            <v-card-text class=\"pb-0\">\r\n              <div class=\"excel-import-container\">\r\n                <v-btn \r\n                  color=\"success\" \r\n                  block \r\n                  outlined\r\n                  class=\"mb-3\" \r\n                  @click=\"downloadTemplate\"\r\n                >\r\n                  <v-icon left>mdi-file-download</v-icon>\r\n                  下载Excel导入模板\r\n                </v-btn>\r\n                \r\n                <v-file-input\r\n                  v-model=\"excelFile\"\r\n                  label=\"选择Excel文件\"\r\n                  prepend-icon=\"mdi-file-excel\"\r\n                  outlined\r\n                  dense\r\n                  accept=\".xlsx,.xls\"\r\n                  :rules=\"[v => !v || v.size < 5000000 || '文件大小不能超过5MB']\"\r\n                  show-size\r\n                  counter\r\n                  class=\"mb-3\"\r\n                ></v-file-input>\r\n                \r\n                <v-btn \r\n                  color=\"primary\" \r\n                  :loading=\"isImporting\"\r\n                  :disabled=\"!excelFile\"\r\n                  block \r\n                  @click=\"importExcel\"\r\n                >\r\n                  <v-icon left>mdi-database-import</v-icon>\r\n                  {{ isImporting ? '导入中...' : '开始导入' }}\r\n                </v-btn>\r\n              </div>\r\n              \r\n              <!-- 导入结果显示 -->\r\n              <v-expand-transition>\r\n                <div v-if=\"importResult\">\r\n                  <v-divider class=\"my-4\"></v-divider>\r\n                  <v-alert\r\n                    :type=\"importResult.success ? 'success' : 'error'\"\r\n                    class=\"mb-3\"\r\n                  >\r\n                    {{ importResult.success ? '导入完成' : '导入失败' }}\r\n                    <template v-if=\"importResult.success\">\r\n                      （共{{ importResult.total }}条，成功{{ importResult.success_count }}条，失败{{ importResult.failed_count }}条）\r\n                    </template>\r\n                    <template v-else>\r\n                      {{ importResult.error }}\r\n                    </template>\r\n                  </v-alert>\r\n                  \r\n                  <div v-if=\"importResult.details && importResult.details.length > 0\">\r\n                    <v-simple-table dense class=\"elevation-1\">\r\n                      <template v-slot:default>\r\n                        <thead>\r\n                          <tr>\r\n                            <th>学号</th>\r\n                            <th>姓名</th>\r\n                            <th>班级</th>\r\n                            <th>状态</th>\r\n                            <th>消息</th>\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                          <tr v-for=\"(record, index) in importResult.details\" :key=\"index\">\r\n                            <td>{{ record.student_id }}</td>\r\n                            <td>{{ record.student_name }}</td>\r\n                            <td>{{ record.class_id }}</td>\r\n                            <td>\r\n                              <v-chip\r\n                                small\r\n                                :color=\"record.success ? 'success' : 'error'\"\r\n                                text-color=\"white\"\r\n                              >\r\n                                {{ record.success ? '成功' : '失败' }}\r\n                              </v-chip>\r\n                            </td>\r\n                            <td>{{ record.message }}</td>\r\n                          </tr>\r\n                        </tbody>\r\n                      </template>\r\n                    </v-simple-table>\r\n                  </div>\r\n                </div>\r\n              </v-expand-transition>\r\n            </v-card-text>\r\n          </v-card>\r\n        </v-col>\r\n      </v-row>\r\n      \r\n      <v-row class=\"mt-4\" v-if=\"capturedImage\">\r\n        <v-col cols=\"12\">\r\n          <v-card class=\"solid-card hover-card\" elevation=\"2\">\r\n            <v-card-title class=\"subtitle-1 font-weight-medium\">\r\n              <v-icon left color=\"primary\">mdi-information-outline</v-icon>\r\n              注册须知\r\n            </v-card-title>\r\n            <v-card-text>\r\n              <v-row>\r\n                <v-col cols=\"12\" md=\"6\">\r\n                  <div class=\"info-item\">\r\n                    <v-icon color=\"primary\" class=\"mr-2\">mdi-check-circle</v-icon>\r\n                    <span>确保拍摄的照片光线充足，人脸清晰</span>\r\n                  </div>\r\n                </v-col>\r\n                <v-col cols=\"12\" md=\"6\">\r\n                  <div class=\"info-item\">\r\n                    <v-icon color=\"primary\" class=\"mr-2\">mdi-check-circle</v-icon>\r\n                    <span>请填写真实准确的个人信息</span>\r\n                  </div>\r\n                </v-col>\r\n                <v-col cols=\"12\" md=\"6\">\r\n                  <div class=\"info-item\">\r\n                    <v-icon color=\"warning\" class=\"mr-2\">mdi-alert-circle</v-icon>\r\n                    <span>人脸数据会安全加密存储</span>\r\n                  </div>\r\n                </v-col>\r\n                <v-col cols=\"12\" md=\"6\">\r\n                  <div class=\"info-item\">\r\n                    <v-icon color=\"warning\" class=\"mr-2\">mdi-alert-circle</v-icon>\r\n                    <span>注册成功后，可直接进行考勤打卡</span>\r\n                  </div>\r\n                </v-col>\r\n              </v-row>\r\n            </v-card-text>\r\n          </v-card>\r\n        </v-col>\r\n      </v-row>\r\n    </v-container>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"Register\",\r\n  data() {\r\n    return {\r\n      videoStream: null,\r\n      capturedImage: null,\r\n      studentId: \"\",\r\n      studentName: \"\",\r\n      classId: \"\",\r\n      classes: [\r\n        { id: \"class1\", name: \"计算机科学与技术1班\" },\r\n        { id: \"class2\", name: \"软件工程1班\" },\r\n        { id: \"class3\", name: \"人工智能1班\" }\r\n      ],\r\n      isSubmitting: false,\r\n      registrationStatus: null,\r\n      excelFile: null,\r\n      isImporting: false,\r\n      importResult: null\r\n    };\r\n  },\r\n  mounted() {\r\n    this.startCamera();\r\n  },\r\n  beforeUnmount() {\r\n    this.stopCamera();\r\n  },\r\n  methods: {\r\n    startCamera() {\r\n      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\r\n        navigator.mediaDevices\r\n          .getUserMedia({ video: true })\r\n          .then(stream => {\r\n            this.videoStream = stream;\r\n            this.$refs.video.srcObject = stream;\r\n          })\r\n          .catch(err => {\r\n            console.error(\"无法访问摄像头:\", err);\r\n            alert(\"无法访问摄像头，请确保您的设备有摄像头并且已授权使用。\");\r\n          });\r\n      } else {\r\n        console.error(\"浏览器不支持getUserMedia\");\r\n        alert(\"您的浏览器不支持访问摄像头功能，请更换浏览器后重试。\");\r\n      }\r\n    },\r\n    stopCamera() {\r\n      if (this.videoStream) {\r\n        this.videoStream.getTracks().forEach(track => track.stop());\r\n      }\r\n    },\r\n    captureImage() {\r\n      const video = this.$refs.video;\r\n      const canvas = this.$refs.canvas;\r\n      const context = canvas.getContext(\"2d\");\r\n      \r\n      // 设置canvas尺寸与视频一致\r\n      canvas.width = video.videoWidth;\r\n      canvas.height = video.videoHeight;\r\n      \r\n      // 在canvas上绘制当前视频帧\r\n      context.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n      \r\n      // 获取图像数据并转换为URL (高质量JPEG)\r\n      this.capturedImage = canvas.toDataURL(\"image/jpeg\", 0.95);\r\n      \r\n      console.log(\"图像已捕获\");\r\n      console.log(`图像数据长度: ${this.capturedImage.length} 字符`);\r\n      console.log(`图像数据前缀: ${this.capturedImage.substring(0, 50)}...`);\r\n    },\r\n    clearCapturedImage() {\r\n      this.capturedImage = null;\r\n    },\r\n    async registerFace() {\r\n      // 表单验证\r\n      if (!this.capturedImage) {\r\n        this.showStatus(\"请先拍照捕获人脸图像\", \"error\");\r\n        return;\r\n      }\r\n      \r\n      if (!this.studentId || !this.studentName || !this.classId) {\r\n        this.showStatus(\"请填写所有必要信息\", \"error\");\r\n        return;\r\n      }\r\n      \r\n      this.isSubmitting = true; // 开始提交状态\r\n      this.showStatus(\"正在处理图像和保存信息...\", \"pending\");\r\n      \r\n      try {\r\n        console.log(\"准备发送注册请求:\");\r\n        console.log(`学号: ${this.studentId}, 姓名: ${this.studentName}, 班级: ${this.classId}`);\r\n        console.log(`图像数据长度: ${this.capturedImage.length} 字符`);\r\n        \r\n        const result = await this.$store.dispatch(\"registerFace\", {\r\n        imageData: this.capturedImage,\r\n        studentId: this.studentId,\r\n          studentName: this.studentName,\r\n          classId: this.classId\r\n      });\r\n      \r\n        console.log(\"注册请求响应:\", result);\r\n      \r\n      if (result.success) {\r\n          this.showStatus(\"注册成功！\", \"success\");\r\n          // 重置表单\r\n          setTimeout(() => {\r\n            this.studentId = \"\";\r\n            this.studentName = \"\";\r\n            this.classId = \"\";\r\n            this.clearCapturedImage();\r\n            this.registrationStatus = null;\r\n          }, 2000);\r\n        } else {\r\n          this.showStatus(`注册失败: ${result.error || '未知错误'}`, \"error\");\r\n        }\r\n      } catch (error) {\r\n        console.error(\"注册过程中发生错误:\", error);\r\n        this.showStatus(`注册错误: ${error.message || '未知错误'}`, \"error\");\r\n      } finally {\r\n        this.isSubmitting = false; // 结束提交状态\r\n    }\r\n  },\r\n    showStatus(message, type) {\r\n      this.registrationStatus = { message, type };\r\n  },\r\n    downloadTemplate() {\r\n      // 显示下载中状态\r\n      this.showStatus(\"正在准备Excel模板...\", \"info\");\r\n      \r\n      // 使用专门的API端点获取模板\r\n      window.location.href = \"/api/student_template\";\r\n      \r\n      // 显示成功状态\r\n      setTimeout(() => {\r\n        this.showStatus(\"模板已下载，请查看下载文件夹\", \"success\");\r\n        \r\n        // 3秒后清除状态\r\n        setTimeout(() => {\r\n          this.registrationStatus = null;\r\n        }, 3000);\r\n      }, 1000);\r\n    },\r\n    async importExcel() {\r\n      if (!this.excelFile) {\r\n        this.$store.commit('SET_ERROR', '请先选择Excel文件');\r\n        return;\r\n      }\r\n      \r\n      this.isImporting = true;\r\n      this.importResult = null;\r\n      \r\n      try {\r\n        const formData = new FormData();\r\n        formData.append('file', this.excelFile);\r\n        \r\n        const response = await fetch('/api/import_excel', {\r\n          method: 'POST',\r\n          body: formData\r\n        });\r\n        \r\n        const result = await response.json();\r\n        \r\n        if (!response.ok) {\r\n          throw new Error(result.error || '导入失败');\r\n        }\r\n        \r\n        this.importResult = result;\r\n        \r\n        if (result.success && result.failed_count === 0) {\r\n          this.excelFile = null;\r\n        }\r\n      } catch (error) {\r\n        console.error('Excel导入出错:', error);\r\n        this.importResult = {\r\n          success: false,\r\n          error: error.message || '导入过程中发生错误'\r\n        };\r\n      } finally {\r\n        this.isImporting = false;\r\n      }\r\n    }\r\n}\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.register-page {\r\n  min-height: calc(100vh - 145px);\r\n  position: relative;\r\n}\r\n\r\n.video-container {\r\n  position: relative;\r\n  margin-bottom: 20px;\r\n  text-align: center;\r\n  overflow: hidden;\r\n  border-radius: 16px;\r\n  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.video-container video,\r\n.captured-image {\r\n  width: 100%;\r\n  max-height: 500px;\r\n  object-fit: cover;\r\n  border-radius: 12px;\r\n}\r\n\r\n.captured-container {\r\n  position: relative;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n.capture-btn {\r\n  margin: 20px auto;\r\n  transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);\r\n}\r\n\r\n.clear-btn {\r\n  position: absolute;\r\n  top: 12px;\r\n  right: 12px;\r\n  z-index: 5;\r\n}\r\n\r\n.info-item {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 12px;\r\n  padding: 10px;\r\n  border-radius: 8px;\r\n  background-color: rgba(0, 0, 0, 0.03);\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.info-item:hover {\r\n  background-color: rgba(0, 0, 0, 0.06);\r\n  transform: translateX(5px);\r\n}\r\n\r\n/* 动画效果 */\r\n.fade-enter-active, .fade-leave-active {\r\n  transition: opacity 0.5s ease;\r\n}\r\n.fade-enter-from, .fade-leave-to {\r\n  opacity: 0;\r\n}\r\n\r\n@keyframes pulse {\r\n  0% {\r\n    transform: scale(1);\r\n  }\r\n  50% {\r\n    transform: scale(1.05);\r\n  }\r\n  100% {\r\n    transform: scale(1);\r\n  }\r\n}\r\n\r\n.pulse {\r\n  animation: pulse 1.5s infinite;\r\n}\r\n\r\n@media (max-width: 600px) {\r\n  .video-container video,\r\n  .captured-image {\r\n    max-height: 350px;\r\n  }\r\n}\r\n</style> "],"mappings":"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","ignoreList":[]}]}