{"remainingRequest":"E:\\内容安全\\final\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\内容安全\\final\\frontend\\src\\views\\Register.vue?vue&type=script&lang=js","dependencies":[{"path":"E:\\内容安全\\final\\frontend\\src\\views\\Register.vue","mtime":1745395228475},{"path":"E:\\内容安全\\final\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1745383817393},{"path":"E:\\内容安全\\final\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1745383814346},{"path":"E:\\内容安全\\final\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1745383817393},{"path":"E:\\内容安全\\final\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1745383816753}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiUmVnaXN0ZXIiLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICB2aWRlb1N0cmVhbTogbnVsbCwKICAgIGNhcHR1cmVkSW1hZ2U6IG51bGwsCiAgICAgIHN0dWRlbnRJZDogIiIsCiAgICAgIHN0dWRlbnROYW1lOiAiIiwKICAgICAgY2xhc3NJZDogIiIsCiAgICAgIGNsYXNzZXM6IFsKICAgICAgICB7IGlkOiAiY2xhc3MxIiwgbmFtZTogIuiuoeeul+acuuenkeWtpuS4juaKgOacrzHnj60iIH0sCiAgICAgICAgeyBpZDogImNsYXNzMiIsIG5hbWU6ICLova/ku7blt6XnqIsx54+tIiB9LAogICAgICAgIHsgaWQ6ICJjbGFzczMiLCBuYW1lOiAi5Lq65bel5pm66IO9MeePrSIgfQogICAgICBdLAogICAgICBpc1N1Ym1pdHRpbmc6IGZhbHNlLAogICAgICByZWdpc3RyYXRpb25TdGF0dXM6IG51bGwKICAgIH07CiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5zdGFydENhbWVyYSgpOwogIH0sCiAgYmVmb3JlVW5tb3VudCgpIHsKICAgIHRoaXMuc3RvcENhbWVyYSgpOwogIH0sCiAgbWV0aG9kczogewogICAgc3RhcnRDYW1lcmEoKSB7CiAgICAgIGlmIChuYXZpZ2F0b3IubWVkaWFEZXZpY2VzICYmIG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKSB7CiAgICAgICAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcwogICAgICAgICAgLmdldFVzZXJNZWRpYSh7IHZpZGVvOiB0cnVlIH0pCiAgICAgICAgICAudGhlbihzdHJlYW0gPT4gewogICAgICAgICAgICB0aGlzLnZpZGVvU3RyZWFtID0gc3RyZWFtOwogICAgICAgICAgICB0aGlzLiRyZWZzLnZpZGVvLnNyY09iamVjdCA9IHN0cmVhbTsKICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goZXJyID0+IHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigi5peg5rOV6K6/6Zeu5pGE5YOP5aS0OiIsIGVycik7CiAgICAgICAgICAgIGFsZXJ0KCLml6Dms5Xorr/pl67mkYTlg4/lpLTvvIzor7fnoa7kv53mgqjnmoTorr7lpIfmnInmkYTlg4/lpLTlubbkuJTlt7LmjojmnYPkvb/nlKjjgIIiKTsKICAgICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIua1j+iniOWZqOS4jeaUr+aMgWdldFVzZXJNZWRpYSIpOwogICAgICAgIGFsZXJ0KCLmgqjnmoTmtY/op4jlmajkuI3mlK/mjIHorr/pl67mkYTlg4/lpLTlip/og73vvIzor7fmm7TmjaLmtY/op4jlmajlkI7ph43or5XjgIIiKTsKICAgICAgfQogICAgfSwKICAgIHN0b3BDYW1lcmEoKSB7CiAgICAgIGlmICh0aGlzLnZpZGVvU3RyZWFtKSB7CiAgICAgICAgdGhpcy52aWRlb1N0cmVhbS5nZXRUcmFja3MoKS5mb3JFYWNoKHRyYWNrID0+IHRyYWNrLnN0b3AoKSk7CiAgICAgIH0KICAgIH0sCiAgICBjYXB0dXJlSW1hZ2UoKSB7CiAgICAgIGNvbnN0IHZpZGVvID0gdGhpcy4kcmVmcy52aWRlbzsKICAgICAgY29uc3QgY2FudmFzID0gdGhpcy4kcmVmcy5jYW52YXM7CiAgICAgIGNvbnN0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgCiAgICAgIC8vIOiuvue9rmNhbnZhc+WwuuWvuOS4juinhumikeS4gOiHtAogICAgICBjYW52YXMud2lkdGggPSB2aWRlby52aWRlb1dpZHRoOwogICAgICBjYW52YXMuaGVpZ2h0ID0gdmlkZW8udmlkZW9IZWlnaHQ7CiAgICAgIAogICAgICAvLyDlnKhjYW52YXPkuIrnu5jliLblvZPliY3op4bpopHluKcKICAgICAgY29udGV4dC5kcmF3SW1hZ2UodmlkZW8sIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CiAgICAgIAogICAgICAvLyDojrflj5blm77lg4/mlbDmja7lubbovazmjaLkuLpVUkwgKOmrmOi0qOmHj0pQRUcpCiAgICAgIHRoaXMuY2FwdHVyZWRJbWFnZSA9IGNhbnZhcy50b0RhdGFVUkwoImltYWdlL2pwZWciLCAwLjk1KTsKICAgICAgCiAgICAgIGNvbnNvbGUubG9nKCLlm77lg4/lt7LmjZXojrciKTsKICAgICAgY29uc29sZS5sb2coYOWbvuWDj+aVsOaNrumVv+W6pjogJHt0aGlzLmNhcHR1cmVkSW1hZ2UubGVuZ3RofSDlrZfnrKZgKTsKICAgICAgY29uc29sZS5sb2coYOWbvuWDj+aVsOaNruWJjee8gDogJHt0aGlzLmNhcHR1cmVkSW1hZ2Uuc3Vic3RyaW5nKDAsIDUwKX0uLi5gKTsKICAgIH0sCiAgICBjbGVhckNhcHR1cmVkSW1hZ2UoKSB7CiAgICAgIHRoaXMuY2FwdHVyZWRJbWFnZSA9IG51bGw7CiAgICB9LAogICAgYXN5bmMgcmVnaXN0ZXJGYWNlKCkgewogICAgICAvLyDooajljZXpqozor4EKICAgICAgaWYgKCF0aGlzLmNhcHR1cmVkSW1hZ2UpIHsKICAgICAgICB0aGlzLnNob3dTdGF0dXMoIuivt+WFiOaLjeeFp+aNleiOt+S6uuiEuOWbvuWDjyIsICJlcnJvciIpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICAKICAgICAgaWYgKCF0aGlzLnN0dWRlbnRJZCB8fCAhdGhpcy5zdHVkZW50TmFtZSB8fCAhdGhpcy5jbGFzc0lkKSB7CiAgICAgICAgdGhpcy5zaG93U3RhdHVzKCLor7floavlhpnmiYDmnInlv4XopoHkv6Hmga8iLCAiZXJyb3IiKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgCiAgICAgIHRoaXMuaXNTdWJtaXR0aW5nID0gdHJ1ZTsgLy8g5byA5aeL5o+Q5Lqk54q25oCBCiAgICAgIHRoaXMuc2hvd1N0YXR1cygi5q2j5Zyo5aSE55CG5Zu+5YOP5ZKM5L+d5a2Y5L+h5oGvLi4uIiwgInBlbmRpbmciKTsKICAgICAgCiAgICAgIHRyeSB7CiAgICAgICAgY29uc29sZS5sb2coIuWHhuWkh+WPkemAgeazqOWGjOivt+axgjoiKTsKICAgICAgICBjb25zb2xlLmxvZyhg5a2m5Y+3OiAke3RoaXMuc3R1ZGVudElkfSwg5aeT5ZCNOiAke3RoaXMuc3R1ZGVudE5hbWV9LCDnj63nuqc6ICR7dGhpcy5jbGFzc0lkfWApOwogICAgICAgIGNvbnNvbGUubG9nKGDlm77lg4/mlbDmja7plb/luqY6ICR7dGhpcy5jYXB0dXJlZEltYWdlLmxlbmd0aH0g5a2X56ymYCk7CiAgICAgICAgCiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goInJlZ2lzdGVyRmFjZSIsIHsKICAgICAgICBpbWFnZURhdGE6IHRoaXMuY2FwdHVyZWRJbWFnZSwKICAgICAgICBzdHVkZW50SWQ6IHRoaXMuc3R1ZGVudElkLAogICAgICAgICAgc3R1ZGVudE5hbWU6IHRoaXMuc3R1ZGVudE5hbWUsCiAgICAgICAgICBjbGFzc0lkOiB0aGlzLmNsYXNzSWQKICAgICAgfSk7CiAgICAgIAogICAgICAgIGNvbnNvbGUubG9nKCLms6jlhozor7fmsYLlk43lupQ6IiwgcmVzdWx0KTsKICAgICAgCiAgICAgIGlmIChyZXN1bHQuc3VjY2VzcykgewogICAgICAgICAgdGhpcy5zaG93U3RhdHVzKCLms6jlhozmiJDlip/vvIEiLCAic3VjY2VzcyIpOwogICAgICAgICAgLy8g6YeN572u6KGo5Y2VCiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgdGhpcy5zdHVkZW50SWQgPSAiIjsKICAgICAgICAgICAgdGhpcy5zdHVkZW50TmFtZSA9ICIiOwogICAgICAgICAgICB0aGlzLmNsYXNzSWQgPSAiIjsKICAgICAgICAgICAgdGhpcy5jbGVhckNhcHR1cmVkSW1hZ2UoKTsKICAgICAgICAgICAgdGhpcy5yZWdpc3RyYXRpb25TdGF0dXMgPSBudWxsOwogICAgICAgICAgfSwgMjAwMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc2hvd1N0YXR1cyhg5rOo5YaM5aSx6LSlOiAke3Jlc3VsdC5lcnJvciB8fCAn5pyq55+l6ZSZ6K+vJ31gLCAiZXJyb3IiKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigi5rOo5YaM6L+H56iL5Lit5Y+R55Sf6ZSZ6K+vOiIsIGVycm9yKTsKICAgICAgICB0aGlzLnNob3dTdGF0dXMoYOazqOWGjOmUmeivrzogJHtlcnJvci5tZXNzYWdlIHx8ICfmnKrnn6XplJnor68nfWAsICJlcnJvciIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIHRoaXMuaXNTdWJtaXR0aW5nID0gZmFsc2U7IC8vIOe7k+adn+aPkOS6pOeKtuaAgQogICAgfQogIH0sCiAgICBzaG93U3RhdHVzKG1lc3NhZ2UsIHR5cGUpIHsKICAgICAgdGhpcy5yZWdpc3RyYXRpb25TdGF0dXMgPSB7IG1lc3NhZ2UsIHR5cGUgfTsKICB9Cn0KfTsK"},{"version":3,"sources":["Register.vue"],"names":[],"mappings":";AA4DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Register.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"container\">\n    <h1>人脸注册</h1>\n    <div class=\"video-container\">\n      <video ref=\"video\" width=\"640\" height=\"480\" autoplay></video>\n      <canvas ref=\"canvas\" width=\"640\" height=\"480\" style=\"display: none;\"></canvas>\n      <div class=\"captured-container\" v-if=\"capturedImage\">\n        <img :src=\"capturedImage\" alt=\"Captured Image\" class=\"captured-image\" />\n        <button @click=\"clearCapturedImage\" class=\"clear-btn\">重拍</button>\n                  </div>\n      <button @click=\"captureImage\" v-if=\"!capturedImage\" class=\"capture-btn\">拍照</button>\n                  </div>\n                  \n    <div class=\"form-container\">\n      <form @submit.prevent=\"registerFace\">\n        <div class=\"form-group\">\n          <label for=\"studentId\">学号</label>\n          <input\n            type=\"text\"\n            id=\"studentId\"\n                        v-model=\"studentId\"\n                        required\n            class=\"form-control\"\n          />\n        </div>\n        <div class=\"form-group\">\n          <label for=\"studentName\">姓名</label>\n          <input\n            type=\"text\"\n            id=\"studentName\"\n                        v-model=\"studentName\"\n                        required\n            class=\"form-control\"\n          />\n        </div>\n        <div class=\"form-group\">\n          <label for=\"classId\">班级</label>\n          <select id=\"classId\" v-model=\"classId\" required class=\"form-control\">\n            <option value=\"\">请选择班级</option>\n            <option v-for=\"cls in classes\" :key=\"cls.id\" :value=\"cls.id\">\n              {{ cls.name }}\n            </option>\n          </select>\n        </div>\n        <button \n          type=\"submit\" \n          class=\"submit-btn\" \n          :disabled=\"isSubmitting || !capturedImage || !studentId || !studentName || !classId\"\n                      >\n          {{ isSubmitting ? '保存中...' : '保存注册信息' }}\n        </button>\n        <div v-if=\"registrationStatus\" class=\"status-message\" :class=\"registrationStatus.type\">\n          {{ registrationStatus.message }}\n        </div>\n      </form>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: \"Register\",\n  data() {\n    return {\n      videoStream: null,\n    capturedImage: null,\n      studentId: \"\",\n      studentName: \"\",\n      classId: \"\",\n      classes: [\n        { id: \"class1\", name: \"计算机科学与技术1班\" },\n        { id: \"class2\", name: \"软件工程1班\" },\n        { id: \"class3\", name: \"人工智能1班\" }\n      ],\n      isSubmitting: false,\n      registrationStatus: null\n    };\n  },\n  mounted() {\n    this.startCamera();\n  },\n  beforeUnmount() {\n    this.stopCamera();\n  },\n  methods: {\n    startCamera() {\n      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n        navigator.mediaDevices\n          .getUserMedia({ video: true })\n          .then(stream => {\n            this.videoStream = stream;\n            this.$refs.video.srcObject = stream;\n          })\n          .catch(err => {\n            console.error(\"无法访问摄像头:\", err);\n            alert(\"无法访问摄像头，请确保您的设备有摄像头并且已授权使用。\");\n          });\n      } else {\n        console.error(\"浏览器不支持getUserMedia\");\n        alert(\"您的浏览器不支持访问摄像头功能，请更换浏览器后重试。\");\n      }\n    },\n    stopCamera() {\n      if (this.videoStream) {\n        this.videoStream.getTracks().forEach(track => track.stop());\n      }\n    },\n    captureImage() {\n      const video = this.$refs.video;\n      const canvas = this.$refs.canvas;\n      const context = canvas.getContext(\"2d\");\n      \n      // 设置canvas尺寸与视频一致\n      canvas.width = video.videoWidth;\n      canvas.height = video.videoHeight;\n      \n      // 在canvas上绘制当前视频帧\n      context.drawImage(video, 0, 0, canvas.width, canvas.height);\n      \n      // 获取图像数据并转换为URL (高质量JPEG)\n      this.capturedImage = canvas.toDataURL(\"image/jpeg\", 0.95);\n      \n      console.log(\"图像已捕获\");\n      console.log(`图像数据长度: ${this.capturedImage.length} 字符`);\n      console.log(`图像数据前缀: ${this.capturedImage.substring(0, 50)}...`);\n    },\n    clearCapturedImage() {\n      this.capturedImage = null;\n    },\n    async registerFace() {\n      // 表单验证\n      if (!this.capturedImage) {\n        this.showStatus(\"请先拍照捕获人脸图像\", \"error\");\n        return;\n      }\n      \n      if (!this.studentId || !this.studentName || !this.classId) {\n        this.showStatus(\"请填写所有必要信息\", \"error\");\n        return;\n      }\n      \n      this.isSubmitting = true; // 开始提交状态\n      this.showStatus(\"正在处理图像和保存信息...\", \"pending\");\n      \n      try {\n        console.log(\"准备发送注册请求:\");\n        console.log(`学号: ${this.studentId}, 姓名: ${this.studentName}, 班级: ${this.classId}`);\n        console.log(`图像数据长度: ${this.capturedImage.length} 字符`);\n        \n        const result = await this.$store.dispatch(\"registerFace\", {\n        imageData: this.capturedImage,\n        studentId: this.studentId,\n          studentName: this.studentName,\n          classId: this.classId\n      });\n      \n        console.log(\"注册请求响应:\", result);\n      \n      if (result.success) {\n          this.showStatus(\"注册成功！\", \"success\");\n          // 重置表单\n          setTimeout(() => {\n            this.studentId = \"\";\n            this.studentName = \"\";\n            this.classId = \"\";\n            this.clearCapturedImage();\n            this.registrationStatus = null;\n          }, 2000);\n        } else {\n          this.showStatus(`注册失败: ${result.error || '未知错误'}`, \"error\");\n        }\n      } catch (error) {\n        console.error(\"注册过程中发生错误:\", error);\n        this.showStatus(`注册错误: ${error.message || '未知错误'}`, \"error\");\n      } finally {\n        this.isSubmitting = false; // 结束提交状态\n    }\n  },\n    showStatus(message, type) {\n      this.registrationStatus = { message, type };\n  }\n}\n};\n</script>\n\n<style scoped>\n.container {\n  max-width: 800px;\n  margin: 0 auto;\n  padding: 20px;\n}\n\n.video-container {\n  position: relative;\n  margin-bottom: 20px;\n  text-align: center;\n  border: 1px solid #ccc;\n  padding: 10px;\n  border-radius: 5px;\n}\n\n.captured-container {\n  position: relative;\n  display: inline-block;\n}\n\n.captured-image {\n  max-width: 100%;\n  max-height: 480px;\n  display: block;\n  margin: 0 auto;\n}\n\n.capture-btn, .clear-btn, .submit-btn {\n  padding: 10px 20px;\n  background-color: #4CAF50;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 16px;\n  margin: 10px 0;\n}\n\n.capture-btn:hover, .clear-btn:hover, .submit-btn:hover {\n  background-color: #45a049;\n}\n\n.capture-btn:disabled, .clear-btn:disabled, .submit-btn:disabled {\n  background-color: #cccccc;\n  cursor: not-allowed;\n}\n\n.clear-btn {\n  background-color: #f44336;\n  position: absolute;\n  top: 10px;\n  right: 10px;\n}\n\n.clear-btn:hover {\n  background-color: #d32f2f;\n}\n\n.form-container {\n  margin-top: 20px;\n}\n\n.form-group {\n  margin-bottom: 15px;\n}\n\nlabel {\n  display: block;\n  margin-bottom: 5px;\n}\n\ninput, select {\n  width: 100%;\n  padding: 8px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n  box-sizing: border-box;\n}\n\n.status-message {\n  margin-top: 15px;\n  padding: 10px;\n  border-radius: 4px;\n  text-align: center;\n}\n\n.success {\n  background-color: #d4edda;\n  color: #155724;\n  border: 1px solid #c3e6cb;\n}\n\n.error {\n  background-color: #f8d7da;\n  color: #721c24;\n  border: 1px solid #f5c6cb;\n}\n\n.pending {\n  background-color: #e2f3f5;\n  color: #0c5460;\n  border: 1px solid #bee5eb;\n}\n</style> "]}]}