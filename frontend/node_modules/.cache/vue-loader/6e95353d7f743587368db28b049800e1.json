{"remainingRequest":"E:\\Face_attendance_system\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\Face_attendance_system\\frontend\\src\\views\\Register.vue?vue&type=script&lang=js","dependencies":[{"path":"E:\\Face_attendance_system\\frontend\\src\\views\\Register.vue","mtime":1745508451673},{"path":"E:\\Face_attendance_system\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1745498657290},{"path":"E:\\Face_attendance_system\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1745498657101},{"path":"E:\\Face_attendance_system\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1745498657290},{"path":"E:\\Face_attendance_system\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1745498665241}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJSZWdpc3RlciIsDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHZpZGVvU3RyZWFtOiBudWxsLA0KICAgICAgY2FwdHVyZWRJbWFnZTogbnVsbCwNCiAgICAgIHN0dWRlbnRJZDogIiIsDQogICAgICBzdHVkZW50TmFtZTogIiIsDQogICAgICBjbGFzc0lkOiAiIiwNCiAgICAgIGNsYXNzZXM6IFsNCiAgICAgICAgeyBpZDogImNsYXNzMSIsIG5hbWU6ICLorqHnrpfmnLrnp5HlrabkuI7mioDmnK8x54+tIiB9LA0KICAgICAgICB7IGlkOiAiY2xhc3MyIiwgbmFtZTogIui9r+S7tuW3peeoizHnj60iIH0sDQogICAgICAgIHsgaWQ6ICJjbGFzczMiLCBuYW1lOiAi5Lq65bel5pm66IO9MeePrSIgfQ0KICAgICAgXSwNCiAgICAgIGlzU3VibWl0dGluZzogZmFsc2UsDQogICAgICByZWdpc3RyYXRpb25TdGF0dXM6IG51bGwsDQogICAgICBleGNlbEZpbGU6IG51bGwsDQogICAgICBpc0ltcG9ydGluZzogZmFsc2UsDQogICAgICBpbXBvcnRSZXN1bHQ6IG51bGwNCiAgICB9Ow0KICB9LA0KICBtb3VudGVkKCkgew0KICAgIHRoaXMuc3RhcnRDYW1lcmEoKTsNCiAgfSwNCiAgYmVmb3JlVW5tb3VudCgpIHsNCiAgICB0aGlzLnN0b3BDYW1lcmEoKTsNCiAgfSwNCiAgbWV0aG9kczogew0KICAgIHN0YXJ0Q2FtZXJhKCkgew0KICAgICAgaWYgKG5hdmlnYXRvci5tZWRpYURldmljZXMgJiYgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEpIHsNCiAgICAgICAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcw0KICAgICAgICAgIC5nZXRVc2VyTWVkaWEoeyB2aWRlbzogdHJ1ZSB9KQ0KICAgICAgICAgIC50aGVuKHN0cmVhbSA9PiB7DQogICAgICAgICAgICB0aGlzLnZpZGVvU3RyZWFtID0gc3RyZWFtOw0KICAgICAgICAgICAgdGhpcy4kcmVmcy52aWRlby5zcmNPYmplY3QgPSBzdHJlYW07DQogICAgICAgICAgfSkNCiAgICAgICAgICAuY2F0Y2goZXJyID0+IHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIuaXoOazleiuv+mXruaRhOWDj+WktDoiLCBlcnIpOw0KICAgICAgICAgICAgYWxlcnQoIuaXoOazleiuv+mXruaRhOWDj+WktO+8jOivt+ehruS/neaCqOeahOiuvuWkh+acieaRhOWDj+WktOW5tuS4lOW3suaOiOadg+S9v+eUqOOAgiIpOw0KICAgICAgICAgIH0pOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29uc29sZS5lcnJvcigi5rWP6KeI5Zmo5LiN5pSv5oyBZ2V0VXNlck1lZGlhIik7DQogICAgICAgIGFsZXJ0KCLmgqjnmoTmtY/op4jlmajkuI3mlK/mjIHorr/pl67mkYTlg4/lpLTlip/og73vvIzor7fmm7TmjaLmtY/op4jlmajlkI7ph43or5XjgIIiKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIHN0b3BDYW1lcmEoKSB7DQogICAgICBpZiAodGhpcy52aWRlb1N0cmVhbSkgew0KICAgICAgICB0aGlzLnZpZGVvU3RyZWFtLmdldFRyYWNrcygpLmZvckVhY2godHJhY2sgPT4gdHJhY2suc3RvcCgpKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIGNhcHR1cmVJbWFnZSgpIHsNCiAgICAgIGNvbnN0IHZpZGVvID0gdGhpcy4kcmVmcy52aWRlbzsNCiAgICAgIGNvbnN0IGNhbnZhcyA9IHRoaXMuJHJlZnMuY2FudmFzOw0KICAgICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOw0KICAgICAgDQogICAgICAvLyDorr7nva5jYW52YXPlsLrlr7jkuI7op4bpopHkuIDoh7QNCiAgICAgIGNhbnZhcy53aWR0aCA9IHZpZGVvLnZpZGVvV2lkdGg7DQogICAgICBjYW52YXMuaGVpZ2h0ID0gdmlkZW8udmlkZW9IZWlnaHQ7DQogICAgICANCiAgICAgIC8vIOWcqGNhbnZhc+S4iue7mOWItuW9k+WJjeinhumikeW4pw0KICAgICAgY29udGV4dC5kcmF3SW1hZ2UodmlkZW8sIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7DQogICAgICANCiAgICAgIC8vIOiOt+WPluWbvuWDj+aVsOaNruW5tui9rOaNouS4ulVSTCAo6auY6LSo6YePSlBFRykNCiAgICAgIHRoaXMuY2FwdHVyZWRJbWFnZSA9IGNhbnZhcy50b0RhdGFVUkwoImltYWdlL2pwZWciLCAwLjk1KTsNCiAgICAgIA0KICAgICAgY29uc29sZS5sb2coIuWbvuWDj+W3suaNleiOtyIpOw0KICAgICAgY29uc29sZS5sb2coYOWbvuWDj+aVsOaNrumVv+W6pjogJHt0aGlzLmNhcHR1cmVkSW1hZ2UubGVuZ3RofSDlrZfnrKZgKTsNCiAgICAgIGNvbnNvbGUubG9nKGDlm77lg4/mlbDmja7liY3nvIA6ICR7dGhpcy5jYXB0dXJlZEltYWdlLnN1YnN0cmluZygwLCA1MCl9Li4uYCk7DQogICAgfSwNCiAgICBjbGVhckNhcHR1cmVkSW1hZ2UoKSB7DQogICAgICB0aGlzLmNhcHR1cmVkSW1hZ2UgPSBudWxsOw0KICAgIH0sDQogICAgYXN5bmMgcmVnaXN0ZXJGYWNlKCkgew0KICAgICAgLy8g6KGo5Y2V6aqM6K+BDQogICAgICBpZiAoIXRoaXMuY2FwdHVyZWRJbWFnZSkgew0KICAgICAgICB0aGlzLnNob3dTdGF0dXMoIuivt+WFiOaLjeeFp+aNleiOt+S6uuiEuOWbvuWDjyIsICJlcnJvciIpOw0KICAgICAgICByZXR1cm47DQogICAgICB9DQogICAgICANCiAgICAgIGlmICghdGhpcy5zdHVkZW50SWQgfHwgIXRoaXMuc3R1ZGVudE5hbWUgfHwgIXRoaXMuY2xhc3NJZCkgew0KICAgICAgICB0aGlzLnNob3dTdGF0dXMoIuivt+Whq+WGmeaJgOacieW/heimgeS/oeaBryIsICJlcnJvciIpOw0KICAgICAgICByZXR1cm47DQogICAgICB9DQogICAgICANCiAgICAgIHRoaXMuaXNTdWJtaXR0aW5nID0gdHJ1ZTsgLy8g5byA5aeL5o+Q5Lqk54q25oCBDQogICAgICB0aGlzLnNob3dTdGF0dXMoIuato+WcqOWkhOeQhuWbvuWDj+WSjOS/neWtmOS/oeaBry4uLiIsICJwZW5kaW5nIik7DQogICAgICANCiAgICAgIHRyeSB7DQogICAgICAgIGNvbnNvbGUubG9nKCLlh4blpIflj5HpgIHms6jlhozor7fmsYI6Iik7DQogICAgICAgIGNvbnNvbGUubG9nKGDlrablj7c6ICR7dGhpcy5zdHVkZW50SWR9LCDlp5PlkI06ICR7dGhpcy5zdHVkZW50TmFtZX0sIOePree6pzogJHt0aGlzLmNsYXNzSWR9YCk7DQogICAgICAgIGNvbnNvbGUubG9nKGDlm77lg4/mlbDmja7plb/luqY6ICR7dGhpcy5jYXB0dXJlZEltYWdlLmxlbmd0aH0g5a2X56ymYCk7DQogICAgICAgIA0KICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgicmVnaXN0ZXJGYWNlIiwgew0KICAgICAgICBpbWFnZURhdGE6IHRoaXMuY2FwdHVyZWRJbWFnZSwNCiAgICAgICAgc3R1ZGVudElkOiB0aGlzLnN0dWRlbnRJZCwNCiAgICAgICAgICBzdHVkZW50TmFtZTogdGhpcy5zdHVkZW50TmFtZSwNCiAgICAgICAgICBjbGFzc0lkOiB0aGlzLmNsYXNzSWQNCiAgICAgIH0pOw0KICAgICAgDQogICAgICAgIGNvbnNvbGUubG9nKCLms6jlhozor7fmsYLlk43lupQ6IiwgcmVzdWx0KTsNCiAgICAgIA0KICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7DQogICAgICAgICAgdGhpcy5zaG93U3RhdHVzKCLms6jlhozmiJDlip/vvIEiLCAic3VjY2VzcyIpOw0KICAgICAgICAgIC8vIOmHjee9ruihqOWNlQ0KICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgdGhpcy5zdHVkZW50SWQgPSAiIjsNCiAgICAgICAgICAgIHRoaXMuc3R1ZGVudE5hbWUgPSAiIjsNCiAgICAgICAgICAgIHRoaXMuY2xhc3NJZCA9ICIiOw0KICAgICAgICAgICAgdGhpcy5jbGVhckNhcHR1cmVkSW1hZ2UoKTsNCiAgICAgICAgICAgIHRoaXMucmVnaXN0cmF0aW9uU3RhdHVzID0gbnVsbDsNCiAgICAgICAgICB9LCAyMDAwKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB0aGlzLnNob3dTdGF0dXMoYOazqOWGjOWksei0pTogJHtyZXN1bHQuZXJyb3IgfHwgJ+acquefpemUmeivryd9YCwgImVycm9yIik7DQogICAgICAgIH0NCiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoIuazqOWGjOi/h+eoi+S4reWPkeeUn+mUmeivrzoiLCBlcnJvcik7DQogICAgICAgIHRoaXMuc2hvd1N0YXR1cyhg5rOo5YaM6ZSZ6K+vOiAke2Vycm9yLm1lc3NhZ2UgfHwgJ+acquefpemUmeivryd9YCwgImVycm9yIik7DQogICAgICB9IGZpbmFsbHkgew0KICAgICAgICB0aGlzLmlzU3VibWl0dGluZyA9IGZhbHNlOyAvLyDnu5PmnZ/mj5DkuqTnirbmgIENCiAgICB9DQogIH0sDQogICAgc2hvd1N0YXR1cyhtZXNzYWdlLCB0eXBlKSB7DQogICAgICB0aGlzLnJlZ2lzdHJhdGlvblN0YXR1cyA9IHsgbWVzc2FnZSwgdHlwZSB9Ow0KICB9LA0KICAgIGRvd25sb2FkVGVtcGxhdGUoKSB7DQogICAgICAvLyDmmL7npLrkuIvovb3kuK3nirbmgIENCiAgICAgIHRoaXMuc2hvd1N0YXR1cygi5q2j5Zyo5YeG5aSHRXhjZWzmqKHmnb8uLi4iLCAiaW5mbyIpOw0KICAgICAgDQogICAgICAvLyDkvb/nlKjkuJPpl6jnmoRBUEnnq6/ngrnojrflj5bmqKHmnb8NCiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gIi9hcGkvc3R1ZGVudF90ZW1wbGF0ZSI7DQogICAgICANCiAgICAgIC8vIOaYvuekuuaIkOWKn+eKtuaAgQ0KICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgIHRoaXMuc2hvd1N0YXR1cygi5qih5p2/5bey5LiL6L2977yM6K+35p+l55yL5LiL6L295paH5Lu25aS5IiwgInN1Y2Nlc3MiKTsNCiAgICAgICAgDQogICAgICAgIC8vIDPnp5LlkI7muIXpmaTnirbmgIENCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgdGhpcy5yZWdpc3RyYXRpb25TdGF0dXMgPSBudWxsOw0KICAgICAgICB9LCAzMDAwKTsNCiAgICAgIH0sIDEwMDApOw0KICAgIH0sDQogICAgYXN5bmMgaW1wb3J0RXhjZWwoKSB7DQogICAgICBpZiAoIXRoaXMuZXhjZWxGaWxlKSB7DQogICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnU0VUX0VSUk9SJywgJ+ivt+WFiOmAieaLqUV4Y2Vs5paH5Lu2Jyk7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCiAgICAgIA0KICAgICAgdGhpcy5pc0ltcG9ydGluZyA9IHRydWU7DQogICAgICB0aGlzLmltcG9ydFJlc3VsdCA9IG51bGw7DQogICAgICANCiAgICAgIHRyeSB7DQogICAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7DQogICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZmlsZScsIHRoaXMuZXhjZWxGaWxlKTsNCiAgICAgICAgDQogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy9hcGkvaW1wb3J0X2V4Y2VsJywgew0KICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLA0KICAgICAgICAgIGJvZHk6IGZvcm1EYXRhDQogICAgICAgIH0pOw0KICAgICAgICANCiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpOw0KICAgICAgICANCiAgICAgICAgaWYgKCFyZXNwb25zZS5vaykgew0KICAgICAgICAgIHRocm93IG5ldyBFcnJvcihyZXN1bHQuZXJyb3IgfHwgJ+WvvOWFpeWksei0pScpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICB0aGlzLmltcG9ydFJlc3VsdCA9IHJlc3VsdDsNCiAgICAgICAgDQogICAgICAgIGlmIChyZXN1bHQuc3VjY2VzcyAmJiByZXN1bHQuZmFpbGVkX2NvdW50ID09PSAwKSB7DQogICAgICAgICAgdGhpcy5leGNlbEZpbGUgPSBudWxsOw0KICAgICAgICB9DQogICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdFeGNlbOWvvOWFpeWHuumUmTonLCBlcnJvcik7DQogICAgICAgIHRoaXMuaW1wb3J0UmVzdWx0ID0gew0KICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLA0KICAgICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlIHx8ICflr7zlhaXov4fnqIvkuK3lj5HnlJ/plJnor68nDQogICAgICAgIH07DQogICAgICB9IGZpbmFsbHkgew0KICAgICAgICB0aGlzLmlzSW1wb3J0aW5nID0gZmFsc2U7DQogICAgICB9DQogICAgfQ0KfQ0KfTsNCg=="},{"version":3,"sources":["Register.vue"],"names":[],"mappings":";AAmSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Register.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n  <div class=\"register-page\">\r\n    <v-container>\r\n      <v-row>\r\n        <v-col cols=\"12\">\r\n          <v-card class=\"solid-card mt-3 mb-5\" elevation=\"3\">\r\n            <v-card-title class=\"text-h4 font-weight-bold primary--text py-4\">\r\n              <v-icon large color=\"primary\" class=\"mr-3\">mdi-account-plus</v-icon>\r\n              人脸注册\r\n            </v-card-title>\r\n          </v-card>\r\n        </v-col>\r\n      </v-row>\r\n      \r\n      <v-row>\r\n        <v-col cols=\"12\">\r\n          <v-card class=\"solid-card mb-4\" elevation=\"2\">\r\n            <v-card-title class=\"subtitle-1 font-weight-medium\">\r\n              <v-icon left color=\"primary\">mdi-file-excel</v-icon>\r\n              批量导入\r\n            </v-card-title>\r\n            <v-card-text>\r\n              <v-row>\r\n                <v-col cols=\"12\" md=\"5\">\r\n                  <div>\r\n                    <v-btn \r\n                      color=\"success\" \r\n                      block \r\n                      outlined\r\n                      class=\"mb-2\" \r\n                      @click=\"downloadTemplate\"\r\n                    >\r\n                      <v-icon left>mdi-file-download</v-icon>\r\n                      下载Excel导入模板\r\n                    </v-btn>\r\n                    \r\n                    <a \r\n                      class=\"text-decoration-none\"\r\n                      href=\"/api/student_template\"\r\n                      download\r\n                    >\r\n                      <v-btn \r\n                        color=\"info\" \r\n                        block \r\n                        outlined\r\n                        x-small\r\n                        class=\"mb-4\"\r\n                      >\r\n                        <v-icon left small>mdi-open-in-new</v-icon>\r\n                        直接下载模板\r\n                      </v-btn>\r\n                    </a>\r\n                  </div>\r\n                </v-col>\r\n                <v-col cols=\"12\" md=\"7\">\r\n                  <v-file-input\r\n                    v-model=\"excelFile\"\r\n                    label=\"选择Excel文件\"\r\n                    prepend-icon=\"mdi-file-excel\"\r\n                    outlined\r\n                    dense\r\n                    accept=\".xlsx,.xls\"\r\n                    :rules=\"[v => !v || v.size < 5000000 || '文件大小不能超过5MB']\"\r\n                    show-size\r\n                    counter\r\n                  ></v-file-input>\r\n                </v-col>\r\n                <v-col cols=\"12\">\r\n                  <v-btn \r\n                    color=\"primary\" \r\n                    :loading=\"isImporting\"\r\n                    :disabled=\"!excelFile\"\r\n                    block \r\n                    @click=\"importExcel\"\r\n                  >\r\n                    <v-icon left>mdi-database-import</v-icon>\r\n                    {{ isImporting ? '导入中...' : '开始导入' }}\r\n                  </v-btn>\r\n                </v-col>\r\n              </v-row>\r\n              \r\n              <!-- 导入结果显示 -->\r\n              <v-expand-transition>\r\n                <div v-if=\"importResult\">\r\n                  <v-divider class=\"my-4\"></v-divider>\r\n                  <v-alert\r\n                    :type=\"importResult.success ? 'success' : 'error'\"\r\n                    class=\"mb-3\"\r\n                  >\r\n                    {{ importResult.success ? '导入完成' : '导入失败' }}\r\n                    <template v-if=\"importResult.success\">\r\n                      （共{{ importResult.total }}条，成功{{ importResult.success_count }}条，失败{{ importResult.failed_count }}条）\r\n                    </template>\r\n                    <template v-else>\r\n                      {{ importResult.error }}\r\n                    </template>\r\n                  </v-alert>\r\n                  \r\n                  <div v-if=\"importResult.details && importResult.details.length > 0\">\r\n                    <v-simple-table dense class=\"elevation-1\">\r\n                      <template v-slot:default>\r\n                        <thead>\r\n                          <tr>\r\n                            <th>学号</th>\r\n                            <th>姓名</th>\r\n                            <th>班级</th>\r\n                            <th>状态</th>\r\n                            <th>消息</th>\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                          <tr v-for=\"(record, index) in importResult.details\" :key=\"index\">\r\n                            <td>{{ record.student_id }}</td>\r\n                            <td>{{ record.student_name }}</td>\r\n                            <td>{{ record.class_id }}</td>\r\n                            <td>\r\n                              <v-chip\r\n                                small\r\n                                :color=\"record.success ? 'success' : 'error'\"\r\n                                text-color=\"white\"\r\n                              >\r\n                                {{ record.success ? '成功' : '失败' }}\r\n                              </v-chip>\r\n                            </td>\r\n                            <td>{{ record.message }}</td>\r\n                          </tr>\r\n                        </tbody>\r\n                      </template>\r\n                    </v-simple-table>\r\n                  </div>\r\n                </div>\r\n              </v-expand-transition>\r\n            </v-card-text>\r\n          </v-card>\r\n        </v-col>\r\n      </v-row>\r\n      \r\n      <v-row>\r\n        <v-col cols=\"12\" md=\"7\">\r\n          <v-card class=\"solid-card hover-card mb-4\" elevation=\"2\">\r\n            <v-card-title class=\"subtitle-1 font-weight-medium\">\r\n              <v-icon left color=\"primary\">mdi-camera</v-icon>\r\n              拍摄人脸照片\r\n            </v-card-title>\r\n            <v-card-text>\r\n              <div class=\"video-container rounded-image\">\r\n                <video ref=\"video\" width=\"640\" height=\"480\" autoplay class=\"rounded-lg\"></video>\r\n                <canvas ref=\"canvas\" width=\"640\" height=\"480\" style=\"display: none;\"></canvas>\r\n                <transition name=\"fade\">\r\n                  <div class=\"captured-container\" v-if=\"capturedImage\">\r\n                    <img :src=\"capturedImage\" alt=\"Captured Image\" class=\"captured-image rounded-lg\" />\r\n                    <v-btn fab small color=\"error\" class=\"clear-btn btn-pulse\" @click=\"clearCapturedImage\">\r\n                      <v-icon>mdi-refresh</v-icon>\r\n                    </v-btn>\r\n                  </div>\r\n                </transition>\r\n                <v-btn\r\n                  color=\"primary\"\r\n                  large\r\n                  rounded\r\n                  class=\"capture-btn btn-pulse mt-3\"\r\n                  v-if=\"!capturedImage\"\r\n                  @click=\"captureImage\"\r\n                >\r\n                  <v-icon left>mdi-camera</v-icon>\r\n                  拍照\r\n                </v-btn>\r\n              </div>\r\n            </v-card-text>\r\n          </v-card>\r\n        </v-col>\r\n        \r\n        <v-col cols=\"12\" md=\"5\">\r\n          <v-card class=\"solid-card hover-card\" elevation=\"2\">\r\n            <v-card-title class=\"subtitle-1 font-weight-medium\">\r\n              <v-icon left color=\"primary\">mdi-account-details</v-icon>\r\n              学生信息\r\n            </v-card-title>\r\n            <v-card-text>\r\n              <div class=\"form-container\">\r\n                <v-form @submit.prevent=\"registerFace\">\r\n                  <v-text-field\r\n                    v-model=\"studentId\"\r\n                    label=\"学号\"\r\n                    prepend-icon=\"mdi-identifier\"\r\n                    outlined\r\n                    dense\r\n                    required\r\n                    class=\"mb-3\"\r\n                  ></v-text-field>\r\n                  \r\n                  <v-text-field\r\n                    v-model=\"studentName\"\r\n                    label=\"姓名\"\r\n                    prepend-icon=\"mdi-account\"\r\n                    outlined\r\n                    dense\r\n                    required\r\n                    class=\"mb-3\"\r\n                  ></v-text-field>\r\n                  \r\n                  <v-select\r\n                    v-model=\"classId\"\r\n                    :items=\"classes\"\r\n                    item-text=\"name\"\r\n                    item-value=\"id\"\r\n                    label=\"班级\"\r\n                    prepend-icon=\"mdi-account-group\"\r\n                    outlined\r\n                    dense\r\n                    required\r\n                    class=\"mb-5\"\r\n                  ></v-select>\r\n                  \r\n                  <v-btn \r\n                    type=\"submit\" \r\n                    color=\"primary\" \r\n                    block \r\n                    large\r\n                    rounded\r\n                    class=\"btn-pulse\" \r\n                    elevation=\"2\"\r\n                    :loading=\"isSubmitting\"\r\n                    :disabled=\"isSubmitting || !capturedImage || !studentId || !studentName || !classId\"\r\n                  >\r\n                    <v-icon left>mdi-content-save</v-icon>\r\n                    {{ isSubmitting ? '保存中...' : '保存注册信息' }}\r\n                  </v-btn>\r\n                  \r\n                  <transition name=\"fade\">\r\n                    <v-alert\r\n                      v-if=\"registrationStatus\"\r\n                      :type=\"registrationStatus.type === 'success' ? 'success' : \r\n                            registrationStatus.type === 'error' ? 'error' : 'info'\"\r\n                      dense\r\n                      class=\"mt-4\"\r\n                      transition=\"scale-transition\"\r\n                    >\r\n                      {{ registrationStatus.message }}\r\n                    </v-alert>\r\n                  </transition>\r\n                </v-form>\r\n              </div>\r\n            </v-card-text>\r\n          </v-card>\r\n        </v-col>\r\n      </v-row>\r\n      \r\n      <v-row class=\"mt-4\" v-if=\"capturedImage\">\r\n        <v-col cols=\"12\">\r\n          <v-card class=\"solid-card hover-card\" elevation=\"2\">\r\n            <v-card-title class=\"subtitle-1 font-weight-medium\">\r\n              <v-icon left color=\"primary\">mdi-information-outline</v-icon>\r\n              注册须知\r\n            </v-card-title>\r\n            <v-card-text>\r\n              <v-row>\r\n                <v-col cols=\"12\" md=\"6\">\r\n                  <div class=\"info-item\">\r\n                    <v-icon color=\"primary\" class=\"mr-2\">mdi-check-circle</v-icon>\r\n                    <span>确保拍摄的照片光线充足，人脸清晰</span>\r\n                  </div>\r\n                </v-col>\r\n                <v-col cols=\"12\" md=\"6\">\r\n                  <div class=\"info-item\">\r\n                    <v-icon color=\"primary\" class=\"mr-2\">mdi-check-circle</v-icon>\r\n                    <span>请填写真实准确的个人信息</span>\r\n                  </div>\r\n                </v-col>\r\n                <v-col cols=\"12\" md=\"6\">\r\n                  <div class=\"info-item\">\r\n                    <v-icon color=\"warning\" class=\"mr-2\">mdi-alert-circle</v-icon>\r\n                    <span>人脸数据会安全加密存储</span>\r\n                  </div>\r\n                </v-col>\r\n                <v-col cols=\"12\" md=\"6\">\r\n                  <div class=\"info-item\">\r\n                    <v-icon color=\"warning\" class=\"mr-2\">mdi-alert-circle</v-icon>\r\n                    <span>注册成功后，可直接进行考勤打卡</span>\r\n                  </div>\r\n                </v-col>\r\n              </v-row>\r\n            </v-card-text>\r\n          </v-card>\r\n        </v-col>\r\n      </v-row>\r\n    </v-container>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"Register\",\r\n  data() {\r\n    return {\r\n      videoStream: null,\r\n      capturedImage: null,\r\n      studentId: \"\",\r\n      studentName: \"\",\r\n      classId: \"\",\r\n      classes: [\r\n        { id: \"class1\", name: \"计算机科学与技术1班\" },\r\n        { id: \"class2\", name: \"软件工程1班\" },\r\n        { id: \"class3\", name: \"人工智能1班\" }\r\n      ],\r\n      isSubmitting: false,\r\n      registrationStatus: null,\r\n      excelFile: null,\r\n      isImporting: false,\r\n      importResult: null\r\n    };\r\n  },\r\n  mounted() {\r\n    this.startCamera();\r\n  },\r\n  beforeUnmount() {\r\n    this.stopCamera();\r\n  },\r\n  methods: {\r\n    startCamera() {\r\n      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\r\n        navigator.mediaDevices\r\n          .getUserMedia({ video: true })\r\n          .then(stream => {\r\n            this.videoStream = stream;\r\n            this.$refs.video.srcObject = stream;\r\n          })\r\n          .catch(err => {\r\n            console.error(\"无法访问摄像头:\", err);\r\n            alert(\"无法访问摄像头，请确保您的设备有摄像头并且已授权使用。\");\r\n          });\r\n      } else {\r\n        console.error(\"浏览器不支持getUserMedia\");\r\n        alert(\"您的浏览器不支持访问摄像头功能，请更换浏览器后重试。\");\r\n      }\r\n    },\r\n    stopCamera() {\r\n      if (this.videoStream) {\r\n        this.videoStream.getTracks().forEach(track => track.stop());\r\n      }\r\n    },\r\n    captureImage() {\r\n      const video = this.$refs.video;\r\n      const canvas = this.$refs.canvas;\r\n      const context = canvas.getContext(\"2d\");\r\n      \r\n      // 设置canvas尺寸与视频一致\r\n      canvas.width = video.videoWidth;\r\n      canvas.height = video.videoHeight;\r\n      \r\n      // 在canvas上绘制当前视频帧\r\n      context.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n      \r\n      // 获取图像数据并转换为URL (高质量JPEG)\r\n      this.capturedImage = canvas.toDataURL(\"image/jpeg\", 0.95);\r\n      \r\n      console.log(\"图像已捕获\");\r\n      console.log(`图像数据长度: ${this.capturedImage.length} 字符`);\r\n      console.log(`图像数据前缀: ${this.capturedImage.substring(0, 50)}...`);\r\n    },\r\n    clearCapturedImage() {\r\n      this.capturedImage = null;\r\n    },\r\n    async registerFace() {\r\n      // 表单验证\r\n      if (!this.capturedImage) {\r\n        this.showStatus(\"请先拍照捕获人脸图像\", \"error\");\r\n        return;\r\n      }\r\n      \r\n      if (!this.studentId || !this.studentName || !this.classId) {\r\n        this.showStatus(\"请填写所有必要信息\", \"error\");\r\n        return;\r\n      }\r\n      \r\n      this.isSubmitting = true; // 开始提交状态\r\n      this.showStatus(\"正在处理图像和保存信息...\", \"pending\");\r\n      \r\n      try {\r\n        console.log(\"准备发送注册请求:\");\r\n        console.log(`学号: ${this.studentId}, 姓名: ${this.studentName}, 班级: ${this.classId}`);\r\n        console.log(`图像数据长度: ${this.capturedImage.length} 字符`);\r\n        \r\n        const result = await this.$store.dispatch(\"registerFace\", {\r\n        imageData: this.capturedImage,\r\n        studentId: this.studentId,\r\n          studentName: this.studentName,\r\n          classId: this.classId\r\n      });\r\n      \r\n        console.log(\"注册请求响应:\", result);\r\n      \r\n      if (result.success) {\r\n          this.showStatus(\"注册成功！\", \"success\");\r\n          // 重置表单\r\n          setTimeout(() => {\r\n            this.studentId = \"\";\r\n            this.studentName = \"\";\r\n            this.classId = \"\";\r\n            this.clearCapturedImage();\r\n            this.registrationStatus = null;\r\n          }, 2000);\r\n        } else {\r\n          this.showStatus(`注册失败: ${result.error || '未知错误'}`, \"error\");\r\n        }\r\n      } catch (error) {\r\n        console.error(\"注册过程中发生错误:\", error);\r\n        this.showStatus(`注册错误: ${error.message || '未知错误'}`, \"error\");\r\n      } finally {\r\n        this.isSubmitting = false; // 结束提交状态\r\n    }\r\n  },\r\n    showStatus(message, type) {\r\n      this.registrationStatus = { message, type };\r\n  },\r\n    downloadTemplate() {\r\n      // 显示下载中状态\r\n      this.showStatus(\"正在准备Excel模板...\", \"info\");\r\n      \r\n      // 使用专门的API端点获取模板\r\n      window.location.href = \"/api/student_template\";\r\n      \r\n      // 显示成功状态\r\n      setTimeout(() => {\r\n        this.showStatus(\"模板已下载，请查看下载文件夹\", \"success\");\r\n        \r\n        // 3秒后清除状态\r\n        setTimeout(() => {\r\n          this.registrationStatus = null;\r\n        }, 3000);\r\n      }, 1000);\r\n    },\r\n    async importExcel() {\r\n      if (!this.excelFile) {\r\n        this.$store.commit('SET_ERROR', '请先选择Excel文件');\r\n        return;\r\n      }\r\n      \r\n      this.isImporting = true;\r\n      this.importResult = null;\r\n      \r\n      try {\r\n        const formData = new FormData();\r\n        formData.append('file', this.excelFile);\r\n        \r\n        const response = await fetch('/api/import_excel', {\r\n          method: 'POST',\r\n          body: formData\r\n        });\r\n        \r\n        const result = await response.json();\r\n        \r\n        if (!response.ok) {\r\n          throw new Error(result.error || '导入失败');\r\n        }\r\n        \r\n        this.importResult = result;\r\n        \r\n        if (result.success && result.failed_count === 0) {\r\n          this.excelFile = null;\r\n        }\r\n      } catch (error) {\r\n        console.error('Excel导入出错:', error);\r\n        this.importResult = {\r\n          success: false,\r\n          error: error.message || '导入过程中发生错误'\r\n        };\r\n      } finally {\r\n        this.isImporting = false;\r\n      }\r\n    }\r\n}\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.register-page {\r\n  min-height: calc(100vh - 145px);\r\n  position: relative;\r\n}\r\n\r\n.video-container {\r\n  position: relative;\r\n  margin-bottom: 20px;\r\n  text-align: center;\r\n  overflow: hidden;\r\n  border-radius: 16px;\r\n  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.video-container video,\r\n.captured-image {\r\n  width: 100%;\r\n  max-height: 500px;\r\n  object-fit: cover;\r\n  border-radius: 12px;\r\n}\r\n\r\n.captured-container {\r\n  position: relative;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n.capture-btn {\r\n  margin: 20px auto;\r\n  transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);\r\n}\r\n\r\n.clear-btn {\r\n  position: absolute;\r\n  top: 12px;\r\n  right: 12px;\r\n  z-index: 5;\r\n}\r\n\r\n.info-item {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 12px;\r\n  padding: 10px;\r\n  border-radius: 8px;\r\n  background-color: rgba(0, 0, 0, 0.03);\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.info-item:hover {\r\n  background-color: rgba(0, 0, 0, 0.06);\r\n  transform: translateX(5px);\r\n}\r\n\r\n/* 动画效果 */\r\n.fade-enter-active, .fade-leave-active {\r\n  transition: opacity 0.5s ease;\r\n}\r\n.fade-enter-from, .fade-leave-to {\r\n  opacity: 0;\r\n}\r\n\r\n@keyframes pulse {\r\n  0% {\r\n    transform: scale(1);\r\n  }\r\n  50% {\r\n    transform: scale(1.05);\r\n  }\r\n  100% {\r\n    transform: scale(1);\r\n  }\r\n}\r\n\r\n.pulse {\r\n  animation: pulse 1.5s infinite;\r\n}\r\n\r\n@media (max-width: 600px) {\r\n  .video-container video,\r\n  .captured-image {\r\n    max-height: 350px;\r\n  }\r\n}\r\n</style> "]}]}